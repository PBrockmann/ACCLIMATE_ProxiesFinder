/*!
 * dc-addons v0.13.1
 *
 * 2016-04-08 11:34:39
 *
 */
!function(){"use strict";return dc.serverChart?!1:("dc"in window||(window.dc={}),void(dc.serverChart=function(a){
//---------------------
// Browser Events
//---------------------
function b(){r.selectAll(C).each(function(a,b){var c=d3.select(this),d=m(c);"function"==typeof dc.serverChart["attachEvents"+d]&&dc.serverChart["attachEvents"+d](b,c)})}function c(a,b){if(b.select("g.brush").size()>0){var c=b.select("g.brush").select(".background").attr("width");b.select("g.brush").on("mousedown",function(){u=d3.mouse(this),y=w,x=v}).on("mousemove",function(){if(null!==u){var a=d3.mouse(this),b=d3.select(this),d=null;if(z){var e=a[0]-u[0];w=y+e,v=x+e,0>w&&(w=0,v=x-y),v>c&&(v=c,w=c-(x-y))}else A?(w=w,v=a[0],w>v&&(d=w,w=v,v=d,A=!1,B=!0),0>w&&(w=0),v>c&&(v=c)):B?(w=a[0],v=v,w>v&&(d=w,w=v,v=d,A=!0,B=!1),0>w&&(w=0),v>c&&(v=c)):(w=d3.min([a[0],u[0]]),v=d3.max([a[0],u[0]]),0>w&&(w=0),v>c&&(v=c));b.select(".extent").attr("x",w).attr("width",v-w),b.selectAll("g.resize").style("display","inline"),b.select("g.resize.e").attr("transform","translate("+v+", 0)"),b.select("g.resize.w").attr("transform","translate("+w+", 0)")}}).on("mouseup",function(){var b=d3.mouse(this),c=d3.select(this);null===u||b[0]===u[0]?(c.select(".extent").attr("width",0),c.selectAll("g.resize").style("display","none"),d(a,[null,null])):
// somehow calculate what was selected
d(a,[w,v]),u=null}),b.select("g.brush").select(".extent").on("mousedown",function(){z=!0}).on("mouseup",function(){z=!1}),b.select("g.brush").select("g.resize.e").on("mousedown",function(){A=!0}).on("mouseup",function(){A=!1}),b.select("g.brush").select("g.resize.w").on("mousedown",function(){B=!0}).on("mouseup",function(){B=!1})}}
//---------------------
// Socket Events
//---------------------
function d(a,b){o.emit("filter",[a,b])}function e(){if(k(),!s.name)throw Error("Name is a required option");o.emit("render",s.name)}function f(a){r.selectAll("*").remove();for(var b=0;b<a.length;b++)r.append("div").style("width",a[b].width+"px").style("height",a[b].height+"px").style("float","left").style("text-align","center").style("line-height",a[b].height+"px").html(s.loadingMessage)}function g(a){r.html(a),b()}function h(a){r.html(s.errorMessage),console.warn(a)}function i(a){var c=document.createElement("div");c.innerHTML=a,c=d3.select(c),r.selectAll(C).each(function(a,d){var e=d3.select(this),f=c.selectAll(C).filter(function(a,b){return b===d}),g=m(e);g&&("function"==typeof dc.serverChart["redraw"+g]?dc.serverChart["redraw"+g](d,e,f):(e.html(f.html()),b()))})}function j(){p&&o.emit("updateConditions",t)}
//---------------------
// Helper Functions
//---------------------
function k(){r.html(s.loadingMessage)}function l(){o=io(s.server,{reconnectionDelay:500,reconnectionDelayMax:2e3,reconnectionAttempts:4}),o.io.on("open",function(){q=!0}),o.io.on("reconnecting",function(){q||r.html(s.reconnectingMessage)}),o.io.on("reconnect_failed",function(){q||r.html(s.connectionErrorMessage)}),o.on("preRender",f),o.on("afterRender",g),o.on("afterRenderError",h),o.on("afterFilter",i),o.on("afterFilterError",h),p=!0}function m(a){try{var b=a.attr("data-type").split("");return b[0]=b[0].toUpperCase(),b.join("")}catch(a){return null}}var n={},o=null,p=!1,q=!1,r=d3.select(a),s={name:null,server:"http://127.0.0.1:3000/",errorMessage:"A problem occurred creating the charts. Please try again later",loadingMessage:"Loading",reconnectingMessage:"There appears to be a problem connecting to the server. Retyring...",connectionErrorMessage:"Could not connect to the server."},t=null,u=null,v=null,w=null,x=null,y=null,z=!1,A=!1,B=!1,C=".dc-server-chart";
//---------------------
// Chart Events
//---------------------
//---------------------
// Init
//---------------------
return dc.serverChart.attachEventsBarChart=function(a,b){b.selectAll("rect.bar").on("click",function(b,c){d(a,c)}),c(a,b)},dc.serverChart.attachEventsPieChart=function(a,b){b.selectAll("g.pie-slice").on("click",function(b,c){d(a,c)})},dc.serverChart.attachEventsRowChart=function(a,b){b.selectAll("rect").on("click",function(b,c){d(a,c)})},dc.serverChart.attachEventsPairedRowChart=function(a,b){b.selectAll("svg").selectAll("rect").on("click",function(b,c,e){d(a,2*c-e)})},dc.serverChart.attachEventsLineChart=function(a,b){b.selectAll("circle.dot").on("mousemove",function(){var a=d3.select(this);a.style("fill-opacity",.8),a.style("stroke-opacity",.8)}).on("mouseout",function(){var a=d3.select(this);a.style("fill-opacity",.01),a.style("stroke-opacity",.01)}),c(a,b)},n.render=function(){return l(),e(),n},n.options=function(a){if(0===arguments.length)return s;for(var b in a)a.hasOwnProperty(b)&&(s[b]=a[b]);return n},n.conditions=function(a){return 0===arguments.length?t:(t=a,j(),n)},k(),n}))}(),function(){"use strict";function a(a,c,d){c.selectAll(".axis").each(function(a,g){var h=d3.select(this),i=h.select("path.domain").node().getBBox(),j=h.selectAll("g.tick"),k=j.empty()?null:null!==/translate\([\d.]+,0\)/i.exec(d3.select(j[0][1]).attr("transform")),l=d3.select(h[0][0].nextElementSibling),m=l.empty()?null:null===/translate\(0,[\d.]+\)/i.exec(l.attr("transform")),n=b(d.selectAll(".axis"),g),o=n.selectAll("g.tick"),p=o.empty()?0:parseFloat(d3.select(o[0][0]).select("text").text()),q=o.empty()?1:parseFloat(d3.select(o[0][o[0].length-1]).select("text").text()),r=c.select(k?".grid-line.vertical":".grid-line.horizontal"),s=d.select(k?".grid-line.vertical":".grid-line.horizontal");h.transition().duration(e).ease(f).attr("transform",n.attr("transform")),r.empty()||r.transition().duration(e).ease(f).attr("transform",s.attr("transform")),j.each(function(a,c){var d=d3.select(this),g=d.select("text"),h=parseFloat(g.text()),j=(h-p)/(q-p)*100,l=!1;if(o.each(function(a,g){var i=d3.select(this),j=i.select("text");if(parseFloat(j.text())===h&&(l=!0,d.transition().duration(e).ease(f).attr("transform",i.attr("transform")).attr("opacity",null).style("opacity",i.attr("opacity")).each("end",function(){d.select("text").text(i.select("text").text())}),!r.empty())){var k=b(r.selectAll("line"),c),m=b(s.selectAll("line"),g);k.transition().duration(e).ease(f).attr("x1",m.attr("x1")).attr("y1",m.attr("y1")).attr("x2",m.attr("x2")).attr("y2",m.attr("y2")).attr("transform",null).style("opacity",m.attr("opacity"))}}),!l){var n="";if(k){var t=i.width*j/100;n=m?"translate(-"+t+", 0)":"translate("+t+", 0)"}else n="translate(0, "+(i.height-i.height*j/100)+")";if(d.transition().duration(e).ease(f).attr("transform",n).style("opacity",0).each("end",function(){d.remove()}),!r.empty()){var u=b(r.selectAll("line"),c);u.transition().duration(e).ease(f).attr("transform",n).style("opacity",0).each("end",function(){u.remove()})}}})}),d.selectAll(".axis").each(function(a,g,h){var i=d3.select(this),j=i.selectAll("g.tick");if(!j.empty()){var k=null!==/translate\([\d.]+,0\)/i.exec(d3.select(j[0][1]).attr("transform")),l=d3.select(i[0][0].nextElementSibling),m=l.empty()?null:null===/translate\(0,[\d.]+\)/i.exec(l.attr("transform")),n=b(c.selectAll(".axis"),g),o=n.select("path.domain").node().getBBox(),p=n.selectAll("g.tick"),q=p.empty()?0:parseFloat(d3.select(p[0][0]).select("text").text()),r=p.empty()?1:parseFloat(d3.select(p[0][p[0].length-1]).select("text").text()),s=c.select(k?".grid-line.vertical":".grid-line.horizontal"),t=d.select(k?".grid-line.vertical":".grid-line.horizontal");j.each(function(a,c){var d=d3.select(this),g=d.select("text"),h=d.select("line"),i=parseFloat(g.text()),j=(i-q)/(r-q)*100,l=!1;if(p.each(function(a,b){var c=d3.select(this),d=c.select("text");parseFloat(d.text())===i&&(l=!0)}),!l){var u=0,v="",w="",x=null;x=s.empty()?d.select("line.grid-line"):b(t.selectAll("line"),c),k?(u=o.width*j/100,v=m?"translate(-"+u+", 0)":"translate("+u+", 0)",x.empty()||(w="translate("+(u-x.attr("x1"))+", 0)")):(u=o.height-o.height*j/100,v="translate(0, "+u+")",x.empty()||(w="translate(0, "+(u-x.attr("y1"))+")"));var y=n.append("g").attr("class","tick").attr("transform",v).attr("opacity",0);y.transition().duration(e).ease(f).attr("transform",d.attr("transform")).style("opacity",1),y.append("text").attr("x",g.attr("x")).attr("y",g.attr("y")).attr("dy",g.attr("dy")).attr("style",g.attr("style")).text(g.text()),y.append("line").attr("x1",h.attr("x1")).attr("y1",h.attr("y1")).attr("x2",h.attr("x2")).attr("y2",h.attr("y2")),x.empty()||(s.empty()?y.append("line").attr("class",x.attr("class")).attr("x1",x.attr("x1")).attr("y1",x.attr("y1")).attr("x2",x.attr("x2")).attr("y2",x.attr("y2")):s.append("line").attr("x1",x.attr("x1")).attr("y1",x.attr("y1")).attr("x2",x.attr("x2")).attr("y2",x.attr("y2")).attr("transform",w).attr("opacity",0).transition().duration(e).ease(f).attr("transform","translate(0, 0)").style("opacity",1))}})}})}function b(a,b){return a.filter(function(a,c){return c===b})}function c(a){
// get the points of the pie slice
var b=a.match(g);if(!b)return{startAngle:0,endAngle:2*Math.PI};var c={x1:parseFloat(b[5]),y1:parseFloat(b[6]),x2:parseFloat(b[1]),y2:parseFloat(b[2]),x3:parseFloat(b[3]),y3:parseFloat(b[4])},e={startAngle:d(Math.atan2(c.y2-c.y1,c.x2-c.x1)),endAngle:d(Math.atan2(c.y3-c.y1,c.x3-c.x1))};return e.startAngle<0&&(e.startAngle=0),(e.endAngle>2*Math.PI||e.endAngle<e.startAngle)&&(e.endAngle=2*Math.PI),e}
// since silly maths makes the following angles we have to convert it from
//      -90               -(PI / 2)
// -180     0   or    -PI             0
//       90                  PI / 2
//
// to
//
//     360                   PI * 2
// 270     90   or    PI * 1.5     PI / 2
//     180                      PI
function d(a){var b=.5*Math.PI;return a>=0?b+a:a>=-b?b-Math.abs(a):2.5*Math.PI-Math.abs(a)}if(dc.serverChart.redrawPieChart)return!1;var e=5e3,f="quad-in-out",g=new RegExp(["M ?([\\d\\.e-]+) ?, ?([\\d\\.e-]+) ?",// move to starting point
// see https://developer.mozilla.org/en-US/docs/Web/SVG/Tutorial/Paths#Arcs
"A ?",// start arc
"[\\d\\.e-]+ ?, ?[\\d\\.e-]+ ?,? ",// arc x radius and y radius
"\\d ,? ?",// arc x-axis-rotation
"\\d ?,? ?",// arc large-arc-flag
"\\d ?,? ?",// arc sweep-flag
"([\\d\\.e-]+) ?,? ?([\\d\\.e-]+) ?",// arc finishing points
"L ?([\\d\\.e-]+) ?,? ?([\\d\\.e-]+)",// draw line too
"Z"].join(""));dc.serverChart.redrawPieChart=function(a,d,g){var h=d.select("svg"),i=d.selectAll("g.pie-slice"),j=g.selectAll("g.pie-slice");d.select("g").attr("class",g.select("g").attr("class")),d.selectAll("text").each(function(a,c){var d=d3.select(this),h=b(g.selectAll("text"),c);h.empty()?d.text(""):d.text(h.text()).transition().duration(e).ease(f).attr("transform",h.attr("transform"))}),i.each(function(a,c){var d=d3.select(this),e=b(j,c);if(!e.empty()){d.attr("class",e.attr("class"));var f=e.select("text");f.empty()||d.select("title").text(f.text())}}),i.select("path").each(function(a,c){var d=d3.select(this),e=b(j,c).select("path");e.empty()||d.attr("class",e.attr("class")).attr("fill",e.attr("fill"))}).transition().duration(e).ease(f).attrTween("d",function(a,d,e){var f=d3.min([h.attr("width"),h.attr("height")])/2,g=d3.svg.arc().outerRadius(f).innerRadius(0),i=b(j,d),k="";i.empty()||(k=i.select("path").attr("d"));var l=d3.interpolate(c(e),c(k));return function(a){return g(l(a))}})},dc.serverChart.redrawBarChart=function(c,d,g){var h=d.selectAll("rect.bar"),i=g.selectAll("rect.bar");h.each(function(a,c){var d=d3.select(this),g=b(i,c);d.attr("class",g.attr("class")).attr("fill",g.attr("fill")).transition().duration(e).ease(f).attr("x",g.attr("x")).attr("y",g.attr("y")).attr("width",g.attr("width")).attr("height",g.attr("height"))}),h.select("title").each(function(a,c){var d=d3.select(this),e=b(i,c).select("title");d.text(e.text())}),a(c,d,g)},dc.serverChart.redrawRowChart=dc.serverChart.redrawPairedRowChart=function(c,d,g){d.selectAll("g.row").each(function(a,c){var d=d3.select(this),h=b(g.selectAll("g.row"),c),i=h.select("rect"),j=h.select("text"),k=h.select("title");d.transition().duration(e).ease(f).attr("transform",h.attr("transform")),d.select("rect").attr("class",i.attr("class")).transition().duration(e).ease(f).attr("width",i.attr("width")).attr("height",i.attr("height")).attr("fill",i.attr("fill")).attr("transform",i.attr("transform")),d.select("text").text(j.text()).transition().duration(e).ease(f).attr("x",j.attr("x")).attr("y",j.attr("y")).attr("dy",j.attr("dy")).attr("transform",j.attr("transform")),d.select("title").text(k.text())}),a(c,d,g)},dc.serverChart.redrawLineChart=function(c,d,g){d.selectAll("g.stack").each(function(a,c){var d=d3.select(this),h=b(g.selectAll("g.stack"),c);d.selectAll("path").each(function(a,c){var d=d3.select(this),g=b(h.selectAll("path"),c);d.transition().duration(e).ease(f).attr("stroke",g.attr("stroke")).attr("d",g.attr("d"))})}),a(c,d,g)},dc.serverChart.redrawNumberDisplay=function(a,b,c){var d=b.select("span.number-display"),g=d.text(),h=g.match(/([^\d]*)([\d\.]+)([^\d]*)/i),i=null===h?0:parseFloat(h[2]),j=c.select("span.number-display"),k=j.text(),l=k.match(/([^\d]*)([\d\.]+)([^\d]*)/i),m=null===l?0:parseFloat(l[2]);d.transition().duration(e).ease(f).tween("text",function(){var a=d3.interpolateNumber(i,m);return function(b){var c=d3.format(".2s")(a(b));this.innerHTML=l[1]+c+l[3]}})}}();